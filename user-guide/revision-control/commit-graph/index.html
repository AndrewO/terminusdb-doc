<!DOCTYPE html><html lang="en-US"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=Edge"><title>The Commit Graph - TerminusDB Documentation</title><link rel="shortcut icon" href="/docs/favicon.png" type="image/x-icon"><link rel="stylesheet" href="/docs/assets/css/just-the-docs.css"> <script type="text/javascript" src="/docs/assets/js/vendor/lunr.min.js"></script> <script type="text/javascript" src="/docs/assets/js/just-the-docs.js"></script><meta name="viewport" content="width=device-width, initial-scale=1"><title>The Commit Graph | TerminusDB Documentation</title><meta name="generator" content="Jekyll v3.8.7" /><meta property="og:title" content="The Commit Graph" /><meta property="og:locale" content="en_US" /><meta name="description" content="Documentation for TerminusDB" /><meta property="og:description" content="Documentation for TerminusDB" /><link rel="canonical" href="/docs/user-guide/revision-control/commit-graph/" /><meta property="og:url" content="/docs/user-guide/revision-control/commit-graph/" /><meta property="og:site_name" content="TerminusDB Documentation" /> <script type="application/ld+json"> {"description":"Documentation for TerminusDB","@type":"WebPage","url":"/docs/user-guide/revision-control/commit-graph/","publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"/docs/assets/images/horizontal_lockup_white.png"}},"headline":"The Commit Graph","@context":"https://schema.org"}</script> <script src="https://cdn.usefathom.com/script.js" site="ETLDDMRO" defer></script><body> <svg xmlns="http://www.w3.org/2000/svg" style="display: none;"> <symbol id="link" viewBox="0 0 16 16"><title>Link</title><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path> </symbol> </svg><div class="page-wrap"><div class="side-bar"><div class="site-header"> <a href="/docs" class="site-title lh-tight"><div class="site-logo"></div></a> <button class="menu-button fs-3 js-main-nav-trigger" data-text-toggle="Hide" type="button">Menu</button></div><div class="navigation main-nav js-main-nav"><nav role="navigation" aria-label="Main navigation"><ul class="navigation-list"><li class="navigation-list-item"><a href="/docs/" class="navigation-list-link">Home</a><li class="navigation-list-item"><a href="/docs/getting-started" class="navigation-list-link">Getting started</a><ul class="navigation-list-child-list "><li class="navigation-list-item "><a href="/docs/getting-started/quick-install/" class="navigation-list-link">Quick install with docker</a><li class="navigation-list-item "><a href="/docs/getting-started/other-install/" class="navigation-list-link">Other ways of installing TerminusDB</a><li class="navigation-list-item "><a href="/docs/getting-started/install-clients/" class="navigation-list-link">Installation of JS/ Python Clients</a><li class="navigation-list-item "><a href="/docs/getting-started/package-overview/" class="navigation-list-link">Package overview</a><li class="navigation-list-item "><a href="/docs/getting-started/start-tutorials" class="navigation-list-link">Getting started tutorials</a><li class="navigation-list-item "><a href="/docs/getting-started/essential-basic/" class="navigation-list-link">Essential basic functionality</a><li class="navigation-list-item "><a href="/docs/getting-started/intro-graph/" class="navigation-list-link">Intro to graph data modelling</a><li class="navigation-list-item "><a href="/docs/getting-started/comparison" class="navigation-list-link">Comparison with other tools</a><li class="navigation-list-item "><a href="/docs/getting-started/tutorials/" class="navigation-list-link">Tutorials</a></ul><li class="navigation-list-item active"><a href="/docs/user-guide" class="navigation-list-link">User guide</a><ul class="navigation-list-child-list "><li class="navigation-list-item active"><a href="/docs/user-guide/revision-control" class="navigation-list-link">Revision Control</a><ul class="navigation-list-grand-child-list"><li class="navigation-list-item active"> <a href="/docs/user-guide/revision-control/commit-graph/" class="navigation-list-link active">The Commit Graph</a><li class="navigation-list-item "> <a href="/docs/user-guide/revision-control/time-travel/" class="navigation-list-link">Time Travel</a><li class="navigation-list-item "> <a href="/docs/user-guide/revision-control/branching/" class="navigation-list-link">Braanching</a><li class="navigation-list-item "> <a href="/docs/user-guide/revision-control/merging/" class="navigation-list-link">Merging</a><li class="navigation-list-item "> <a href="/docs/user-guide/revision-control/meta-graph/" class="navigation-list-link">The Meta Graph</a><li class="navigation-list-item "> <a href="/docs/user-guide/revision-control/cloning/" class="navigation-list-link">Cloning Databases</a><li class="navigation-list-item "> <a href="/docs/user-guide/revision-control/pull-push/" class="navigation-list-link">Pull and Push</a><li class="navigation-list-item "> <a href="/docs/user-guide/revision-control/architecture/" class="navigation-list-link">Full Architecture</a></ul><li class="navigation-list-item "><a href="/docs/user-guide/query" class="navigation-list-link">Query</a><li class="navigation-list-item "><a href="/docs/user-guide/schema" class="navigation-list-link">Schema</a><li class="navigation-list-item "><a href="/docs/user-guide/console" class="navigation-list-link">TerminusDB Console</a><li class="navigation-list-item "><a href="/docs/user-guide/visualisation" class="navigation-list-link">Visualisation</a><li class="navigation-list-item "><a href="/docs/user-guide/api/" class="navigation-list-link">TerminusDB API</a><li class="navigation-list-item "><a href="/docs/user-guide/hub/" class="navigation-list-link">TerminusHub</a></ul><li class="navigation-list-item"><a href="/docs/api-reference/" class="navigation-list-link">API reference</a><li class="navigation-list-item"><a href="/docs/administration/" class="navigation-list-link">Administration</a><li class="navigation-list-item"><a href="/docs/developer-guide/" class="navigation-list-link">Developer guide</a><li class="navigation-list-item"><a href="/docs/release_notes/" class="navigation-list-link">Release notes</a><li class="navigation-list-item"><a href="/docs/research/" class="navigation-list-link">Research</a></ul></nav></div><footer class="site-footer"><p class="text-small text-grey-dk-000 mb-4">This site uses <a href="https://github.com/pmarsceill/just-the-docs">Just the Docs</a>, a documentation theme for Jekyll.</p></footer></div><div class="main-content-wrap js-main-content" tabindex="0"><div class="main-content"><div class="page-header js-page-header"><div class="search"><div class="search-input-wrap"> <input type="text" class="js-search-input search-input" tabindex="0" placeholder="Search TerminusDB Documentation" aria-label="Search TerminusDB Documentation" autocomplete="off"> <svg width="14" height="14" viewBox="0 0 28 28" xmlns="http://www.w3.org/2000/svg" class="search-icon"><title>Search</title><g fill-rule="nonzero"><path d="M17.332 20.735c-5.537 0-10-4.6-10-10.247 0-5.646 4.463-10.247 10-10.247 5.536 0 10 4.601 10 10.247s-4.464 10.247-10 10.247zm0-4c3.3 0 6-2.783 6-6.247 0-3.463-2.7-6.247-6-6.247s-6 2.784-6 6.247c0 3.464 2.7 6.247 6 6.247z"/><path d="M11.672 13.791L.192 25.271 3.02 28.1 14.5 16.62z"/></g></svg></div><div class="js-search-results search-results-wrap"></div></div><ul class="list-style-none text-small aux-nav"><li class="d-inline-block my-0"><a href="https://github.com/terminusdb/terminusdb-server">TerminusDB on GitHub</a></ul></div><div class="page"><nav class="breadcrumb-nav"><ol class="breadcrumb-nav-list"><li class="breadcrumb-nav-list-item"><a href="/docs/user-guide">User guide</a><li class="breadcrumb-nav-list-item"><a href="/docs/user-guide/revision-control">Revision Control</a><li class="breadcrumb-nav-list-item"><span>The Commit Graph</span></ol></nav><div id="main-content" class="page-content" role="main"><h1 class="no_toc" id="the-commit-graph"> <a href="#the-commit-graph" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#link"></use></svg></a> The Commit Graph</h1><h2 class="no_toc text-delta" id="table-of-contents"> <a href="#table-of-contents" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#link"></use></svg></a> Table of contents</h2><ol id="markdown-toc"><li><a href="#introduction" id="markdown-toc-introduction">Introduction</a><ol><li><a href="#commit-chains---the-basic-data-structure" id="markdown-toc-commit-chains---the-basic-data-structure">Commit Chains - the basic data structure</a></ol><li><a href="#diagram-explanation" id="markdown-toc-diagram-explanation">Diagram Explanation</a><li><a href="#revision-control-queries" id="markdown-toc-revision-control-queries">Revision Control Queries</a><ol><li><a href="#setting-head-of-woql-client" id="markdown-toc-setting-head-of-woql-client">Setting Head of WOQL client:</a><ol><li><a href="#forming-resource-string-manually" id="markdown-toc-forming-resource-string-manually">Forming Resource String Manually</a></ol><li><a href="#other-contents-of-commit-graph---database-level-meta-data" id="markdown-toc-other-contents-of-commit-graph---database-level-meta-data">Other Contents of Commit Graph - Database Level Meta-data</a><ol><li><a href="#notes" id="markdown-toc-notes">Notes</a></ol></ol></ol><hr /><h1 id="introduction"> <a href="#introduction" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#link"></use></svg></a> Introduction</h1><p>In TerminusDB, every operation that updates the state of a database generates a <em>Commit Record</em> which allows us to recreate the state of the database exactly as it was at the time that the update was completed. Commit records and their associated metadata (timestamps, comments and designation of authorship) can be accessed through a special internal graph called the commit graph within each database. Just like everything else in TerminusDB, this commit data is exposed as a graph which can be queried just like any other graph.</p><p>There are three things that make the <em>commit</em> graph special and different from normal TerminusDB graphs:</p><ol><li>In normal usage it is immutable and append only and never written directly to by the user, but only by the internal database engine (*)<li>Unlike normal data and schema graphs, it is not itself versioned because it contains it’s full history within it.<li>It has a very simple, pre-defined schema consisting of two principle object types (Branch &amp; Commit) and 5 main properties (timestamp, parent, author, message, head)</ol><p>TerminusDB provides a simple query library, covered in the following sections, which provides simple-pre-rolled queries which will extract all of the important information from the <em>commit graph</em> needed to support revision control operations for you, and a simple time-slider UI in the console which does all the work for you, so in the vast majority of use-cases, you will never have to look inside the graph yourself or worry about its structure.</p><p>Still, while it is not absolutely necessary to understand the structure of the commit graph to use the various revision control operations, it can be helpful to have a mental model, and being able to query the graph itself directly really helps understanding what actually happened in these operations. This section provides full details of the data structures and queries that are used in the <em>commit graph</em> with enough detail that you should be able to construct your own custom revision control queries from scratch.</p><h2 id="commit-chains---the-basic-data-structure"> <a href="#commit-chains---the-basic-data-structure" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#link"></use></svg></a> Commit Chains - the basic data structure</h2><h1 id="diagram-explanation"> <a href="#diagram-explanation" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#link"></use></svg></a> Diagram Explanation</h1><p>[ Picture: diagram shows commit parent and branch and how they point at commit ]</p><p>Table shows all properties that exist in the commit graph</p><hr /><h1 id="revision-control-queries"> <a href="#revision-control-queries" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#link"></use></svg></a> Revision Control Queries</h1><p>Translating results from <em>commit graph</em> queries into actual revision control operations is very simple and almost always follows the same basic pattern.</p><ol><li>We query the <em>commit graph</em> with some pattern, involving time, commit author or commit message, to find the id of the specific commit (or branch) we are interested in<li>We take the Commit ID from this result and use it to parameterise subsequent calls to the database and the database behaves as if its contents were exactly as they were at the time that the commit in question completed.</ol><p>The following sections contain many practical examples of querying the commit graph to perform revision control operations. Below we present the general pattern that all such operations take and the two principle ways in which we can plug commit ids into revision control operations. The names of function and the basic paradigm is closely based on the operations and paradigms supported by git, the revision control system for code.</p><h2 id="setting-head-of-woql-client"> <a href="#setting-head-of-woql-client" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#link"></use></svg></a> Setting Head of WOQL client:</h2><p>The WOQL client libraries are designed in such a way that we they have an internal concept of a cursor or “head” which could be any branch or commit in the database. By setting the client head to a specific commit id or to a specific branch, we specify that all subsequent accesses to the Database API will be against that specific branch or historical state of the database rather than whatever the default (latest) version is.</p><p>Set “head” to a specific comit ID CommitID = dbClient.query(Commit_Graph_Query) dbClient.ref(CommitID)</p><p>or</p><p>Branch = dbClient.query(Commit_Graph_Query) dbClient.checkout(Branch)</p><p>This sets the client’s internal head state. All subsequent</p><p>Once we have set the client’s head to point at a particular branch or commit, then subsequent api calls with that client will use that state in the following way:</p><ol><li>client.branch(new_branch_id)</ol><p>Creates a new branch with id <em>new_branch_id</em> starting from the client head (branch or commit id that we set in ref/checkout above). This allows us to start a new branch from any point in the commit history.</p><ol><li>client.merge(target_branch)</ol><p>Merge starting from the client head (branch or commit id that we set in ref/checkout above) into the branch called <em>target_branch</em>. This allows us to merge differences between any commit in our history and any branch (note we can only ever write into the head of a branch because old commits are immutable)</p><ol><li></ol><p>woqlClient.ref(CommitID) woqlClient.checkout(branch)</p><ol><li><p>Branch() =&gt; defines the starting point of a new branch (new branches can start from either the head of a branch or from any specific commit (commit ID)</p><li><p>Merge(…)</p></ol><h3 id="forming-resource-string-manually"> <a href="#forming-resource-string-manually" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#link"></use></svg></a> Forming Resource String Manually</h3><p>(using)</p><p>It should be noted that internally in TerminusDB, a commit ID refers to a very complex structure which actually contains all of the relevant historical data, if you are interested in the internal data structures, they are fully documented in the Full Architecture section and associated papers. However from a user point of view, all you have to know is Commit IDs allow you to set the state of the database to exactly the state that it was when the related update completed and queries to the <em>commit graph</em> allow you to find the Commit IDs that you are interested in.</p><h2 id="other-contents-of-commit-graph---database-level-meta-data"> <a href="#other-contents-of-commit-graph---database-level-meta-data" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#link"></use></svg></a> Other Contents of Commit Graph - Database Level Meta-data</h2><p>(stored here because some things have to have global database scope and we don’t want to change them on branches etc as it makes things too complicated</p><ul><li>prefixes<li>graph structure</ul><h3 id="notes"> <a href="#notes" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#link"></use></svg></a> Notes</h3><ul><li>Administrators can choose to active the write_to_commit_graph capability which will allow them to manually rewrite the commit graph, however, direct updates of the commit graph are completely unsupported and highly inadvisable as the chance of breaking the internal delicate datastructures that lie beneath is extremely high. If you choose to do so, proceed with caution and assume that you will destroy everything.</ul><hr><footer role="contentinfo"><p class="text-small text-grey-dk-000 mb-0">Copyright &copy; 2020 - TerminusDB | Distributed by an <a href="https://github.com/terminusdb/terminusdb-server/blob/master/LICENSE">GPL-3.0 license.</a></p></footer></div></div></div></div>
