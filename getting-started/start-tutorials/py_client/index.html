<!DOCTYPE html><html lang="en-US"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=Edge"><title>Create TerminusDB Graph with Python Client - TerminusDB Documentation</title><link rel="shortcut icon" href="/docs/favicon.png" type="image/x-icon"><link rel="stylesheet" href="/docs/assets/css/just-the-docs.css"> <script type="text/javascript" src="/docs/assets/js/vendor/lunr.min.js"></script> <script type="text/javascript" src="/docs/assets/js/just-the-docs.js"></script><meta name="viewport" content="width=device-width, initial-scale=1"><title>Create TerminusDB Graph with Python Client | TerminusDB Documentation</title><meta name="generator" content="Jekyll v3.8.7" /><meta property="og:title" content="Create TerminusDB Graph with Python Client" /><meta property="og:locale" content="en_US" /><meta name="description" content="Documentation for TerminusDB" /><meta property="og:description" content="Documentation for TerminusDB" /><link rel="canonical" href="/docs/getting-started/start-tutorials/py_client/" /><meta property="og:url" content="/docs/getting-started/start-tutorials/py_client/" /><meta property="og:site_name" content="TerminusDB Documentation" /> <script type="application/ld+json"> {"description":"Documentation for TerminusDB","@type":"WebPage","url":"/docs/getting-started/start-tutorials/py_client/","publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"/docs/assets/images/horizontal_lockup_white.png"}},"headline":"Create TerminusDB Graph with Python Client","@context":"https://schema.org"}</script> <script src="https://cdn.usefathom.com/script.js" site="ETLDDMRO" defer></script><body> <svg xmlns="http://www.w3.org/2000/svg" style="display: none;"> <symbol id="link" viewBox="0 0 16 16"><title>Link</title><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path> </symbol> </svg><div class="page-wrap"><div class="side-bar"><div class="site-header"> <a href="/docs" class="site-title lh-tight"><div class="site-logo"></div></a> <button class="menu-button fs-3 js-main-nav-trigger" data-text-toggle="Hide" type="button">Menu</button></div><div class="navigation main-nav js-main-nav"><nav role="navigation" aria-label="Main navigation"><ul class="navigation-list"><li class="navigation-list-item"><a href="/docs/" class="navigation-list-link">Home</a><li class="navigation-list-item active"><a href="/docs/getting-started" class="navigation-list-link">Getting started</a><ul class="navigation-list-child-list "><li class="navigation-list-item "><a href="/docs/getting-started/quick-install/" class="navigation-list-link">Quick install with docker</a><li class="navigation-list-item "><a href="/docs/getting-started/other-install/" class="navigation-list-link">Other ways of installing TerminusDB</a><li class="navigation-list-item "><a href="/docs/getting-started/install-clients/" class="navigation-list-link">Installation of JS/ Python Clients</a><li class="navigation-list-item "><a href="/docs/getting-started/package-overview/" class="navigation-list-link">Package overview</a><li class="navigation-list-item active"><a href="/docs/getting-started/start-tutorials" class="navigation-list-link">Getting started tutorials</a><ul class="navigation-list-grand-child-list"><li class="navigation-list-item "> <a href="/docs/getting-started/start-tutorials/console_js/" class="navigation-list-link">Create TerminusDB Graph with Console</a><li class="navigation-list-item active"> <a href="/docs/getting-started/start-tutorials/py_client/" class="navigation-list-link active">Create TerminusDB Graph with Python Client</a></ul><li class="navigation-list-item "><a href="/docs/getting-started/essential-basic/" class="navigation-list-link">Essential basic functionality</a><li class="navigation-list-item "><a href="/docs/getting-started/intro-graph/" class="navigation-list-link">Intro to graph data modelling</a><li class="navigation-list-item "><a href="/docs/getting-started/comparison" class="navigation-list-link">Comparison with other tools</a><li class="navigation-list-item "><a href="/docs/getting-started/tutorials/" class="navigation-list-link">Tutorials</a></ul><li class="navigation-list-item"><a href="/docs/user-guide" class="navigation-list-link">User guide</a><ul class="navigation-list-child-list "><li class="navigation-list-item "><a href="/docs/user-guide/revision-control" class="navigation-list-link">Revision Control</a><li class="navigation-list-item "><a href="/docs/user-guide/query" class="navigation-list-link">Query</a><li class="navigation-list-item "><a href="/docs/user-guide/schema" class="navigation-list-link">Schema</a><li class="navigation-list-item "><a href="/docs/user-guide/console" class="navigation-list-link">TerminusDB Console</a><li class="navigation-list-item "><a href="/docs/user-guide/visualisation" class="navigation-list-link">Visualisation</a><li class="navigation-list-item "><a href="/docs/user-guide/api/" class="navigation-list-link">TerminusDB API</a><li class="navigation-list-item "><a href="/docs/user-guide/hub/" class="navigation-list-link">TerminusHub</a></ul><li class="navigation-list-item"><a href="/docs/api-reference/" class="navigation-list-link">API reference</a><li class="navigation-list-item"><a href="/docs/administration/" class="navigation-list-link">Administration</a><li class="navigation-list-item"><a href="/docs/developer-guide/" class="navigation-list-link">Developer guide</a><li class="navigation-list-item"><a href="/docs/release_notes/" class="navigation-list-link">Release notes</a><li class="navigation-list-item"><a href="/docs/research/" class="navigation-list-link">Research</a></ul></nav></div><footer class="site-footer"><p class="text-small text-grey-dk-000 mb-4">This site uses <a href="https://github.com/pmarsceill/just-the-docs">Just the Docs</a>, a documentation theme for Jekyll.</p></footer></div><div class="main-content-wrap js-main-content" tabindex="0"><div class="main-content"><div class="page-header js-page-header"><div class="search"><div class="search-input-wrap"> <input type="text" class="js-search-input search-input" tabindex="0" placeholder="Search TerminusDB Documentation" aria-label="Search TerminusDB Documentation" autocomplete="off"> <svg width="14" height="14" viewBox="0 0 28 28" xmlns="http://www.w3.org/2000/svg" class="search-icon"><title>Search</title><g fill-rule="nonzero"><path d="M17.332 20.735c-5.537 0-10-4.6-10-10.247 0-5.646 4.463-10.247 10-10.247 5.536 0 10 4.601 10 10.247s-4.464 10.247-10 10.247zm0-4c3.3 0 6-2.783 6-6.247 0-3.463-2.7-6.247-6-6.247s-6 2.784-6 6.247c0 3.464 2.7 6.247 6 6.247z"/><path d="M11.672 13.791L.192 25.271 3.02 28.1 14.5 16.62z"/></g></svg></div><div class="js-search-results search-results-wrap"></div></div><ul class="list-style-none text-small aux-nav"><li class="d-inline-block my-0"><a href="https://github.com/terminusdb/terminusdb-server">TerminusDB on GitHub</a></ul></div><div class="page"><nav class="breadcrumb-nav"><ol class="breadcrumb-nav-list"><li class="breadcrumb-nav-list-item"><a href="/docs/getting-started">Getting started</a><li class="breadcrumb-nav-list-item"><a href="/docs/getting-started/start-tutorials">Getting started tutorials</a><li class="breadcrumb-nav-list-item"><span>Create TerminusDB Graph with Python Client</span></ol></nav><div id="main-content" class="page-content" role="main"><h1 class="no_toc" id="create-terminusdb-graph-with-python-client"> <a href="#create-terminusdb-graph-with-python-client" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#link"></use></svg></a> Create TerminusDB Graph with Python Client</h1><p><strong>Note that this tutorial is based on TerminusDB v1.0. Tutorial for new version coming soon.</strong></p><p>In here you will see a step-by-step guide to create your first knowledge with Terminus DB Python Client in Jupyter notebook. We assume already have <a href="https://jupyter.org/install">Jupyter notebook</a> and <a href="/docs/getting-started/install-clients/#python-client">TerminusDB Python Client (with woqlDataframe)</a> installed and have TerminusDB up and running.</p><h2 class="no_toc text-delta" id="table-of-contents"> <a href="#table-of-contents" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#link"></use></svg></a> Table of contents</h2><ol id="markdown-toc"><li><a href="#create-a-database" id="markdown-toc-create-a-database">Create a database</a><li><a href="#create-a-schema" id="markdown-toc-create-a-schema">Create a Schema</a><li><a href="#load-in-the-data" id="markdown-toc-load-in-the-data">Load in the Data</a><ol><li><a href="#get-csvs-into-variables" id="markdown-toc-get-csvs-into-variables">Get csvs into variables</a><li><a href="#data-wrangles" id="markdown-toc-data-wrangles">Data wrangles</a><li><a href="#insert-query" id="markdown-toc-insert-query">Insert Query</a><li><a href="#combine-the-3-and-load-the-csvs" id="markdown-toc-combine-the-3-and-load-the-csvs">Combine the 3 and load the csvs</a></ol><li><a href="#query-the-data" id="markdown-toc-query-the-data">Query The Data</a><li><a href="#graph-visualisation" id="markdown-toc-graph-visualisation">Graph Visualisation</a></ol><hr /><h2 id="create-a-database"> <a href="#create-a-database" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#link"></use></svg></a> Create a database</h2><p>First, import <code class="highlighter-rouge">WOQLClient</code>, <code class="highlighter-rouge">WOQLQuery</code> and <code class="highlighter-rouge">query_to_df</code> form the client library:</p><div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">woqlclient</span> <span class="kn">import</span> <span class="n">WOQLClient</span>
<span class="kn">from</span> <span class="nn">woqlclient</span> <span class="kn">import</span> <span class="n">WOQLQuery</span>
<span class="kn">from</span> <span class="nn">woqlclient</span> <span class="kn">import</span> <span class="n">query_to_df</span>
</code></pre></div></div><p>Then set up server_url and key for the client. For a local database, it’s “http://localhost:6363” and “root” by default. Here we use the <a href="/docs/getting-started/quick-install/">docker image of TerminusDB</a>.</p><p>We also need a database id and a name for the database:</p><div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">server_url</span> <span class="o">=</span> <span class="s">"http://localhost:6363"</span>
<span class="n">key</span> <span class="o">=</span> <span class="s">"root"</span>
<span class="n">dbId</span> <span class="o">=</span> <span class="s">"pybike"</span>
<span class="n">db_name</span> <span class="o">=</span> <span class="s">"Bicycle Graph"</span>
</code></pre></div></div><p>After that, create a WOQLClient object and use <code class="highlighter-rouge">connect()</code> and <code class="highlighter-rouge">createDatabase()</code>.</p><div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">client</span> <span class="o">=</span> <span class="n">WOQLClient</span><span class="p">()</span>
<span class="n">client</span><span class="p">.</span><span class="n">connect</span><span class="p">(</span><span class="n">server_url</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span>
<span class="n">client</span><span class="p">.</span><span class="n">createDatabase</span><span class="p">(</span><span class="n">dbId</span><span class="p">,</span> <span class="n">db_name</span><span class="p">)</span>
</code></pre></div></div><p>Go to the <a href="http://localhost:6363/console">console</a>, we should now have the database created.</p><hr /><h2 id="create-a-schema"> <a href="#create-a-schema" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#link"></use></svg></a> Create a Schema</h2><p>To create a schema, we construct a WOQLQuery object <code class="highlighter-rouge">schema</code> that will create a schema and use <code class="highlighter-rouge">execute()</code> to pass this query to TerminusDB via the client that we set up in the previous step.</p><div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">create_schema</span><span class="p">(</span><span class="n">client</span><span class="p">):</span>
    <span class="s">"""The query which creates the schema
        Parameters - it uses variables rather than the fluent style as an example
        ==========
        client : a WOQLClient() connection
    """</span>
    <span class="n">schema</span> <span class="o">=</span> <span class="n">WOQLQuery</span><span class="p">().</span><span class="n">when</span><span class="p">(</span><span class="bp">True</span><span class="p">).</span><span class="n">woql_and</span><span class="p">(</span>
        <span class="n">WOQLQuery</span><span class="p">().</span><span class="n">doctype</span><span class="p">(</span><span class="s">"Station"</span><span class="p">).</span>
            <span class="n">label</span><span class="p">(</span><span class="s">"Bike Station"</span><span class="p">).</span>
            <span class="n">description</span><span class="p">(</span><span class="s">"A station where bikes are deposited"</span><span class="p">),</span>
        <span class="n">WOQLQuery</span><span class="p">().</span><span class="n">doctype</span><span class="p">(</span><span class="s">"Bicycle"</span><span class="p">).</span><span class="n">label</span><span class="p">(</span><span class="s">"Bicycle"</span><span class="p">),</span>
        <span class="n">WOQLQuery</span><span class="p">().</span><span class="n">doctype</span><span class="p">(</span><span class="s">"Journey"</span><span class="p">).</span><span class="n">label</span><span class="p">(</span><span class="s">"Journey"</span><span class="p">).</span>
            <span class="nb">property</span><span class="p">(</span><span class="s">"start_station"</span><span class="p">,</span> <span class="s">"Station"</span><span class="p">).</span><span class="n">label</span><span class="p">(</span><span class="s">"Start Station"</span><span class="p">).</span>
            <span class="nb">property</span><span class="p">(</span><span class="s">"end_station"</span><span class="p">,</span> <span class="s">"Station"</span><span class="p">).</span><span class="n">label</span><span class="p">(</span><span class="s">"End Station"</span><span class="p">).</span>
            <span class="nb">property</span><span class="p">(</span><span class="s">"duration"</span><span class="p">,</span> <span class="s">"integer"</span><span class="p">).</span><span class="n">label</span><span class="p">(</span><span class="s">"Journey Duration"</span><span class="p">).</span>
            <span class="nb">property</span><span class="p">(</span><span class="s">"start_time"</span><span class="p">,</span> <span class="s">"dateTime"</span><span class="p">).</span><span class="n">label</span><span class="p">(</span><span class="s">"Time Started"</span><span class="p">).</span>
            <span class="nb">property</span><span class="p">(</span><span class="s">"end_time"</span><span class="p">,</span> <span class="s">"dateTime"</span><span class="p">).</span><span class="n">label</span><span class="p">(</span><span class="s">"Time Ended"</span><span class="p">).</span>
            <span class="nb">property</span><span class="p">(</span><span class="s">"journey_bicycle"</span><span class="p">,</span> <span class="s">"Bicycle"</span><span class="p">).</span><span class="n">label</span><span class="p">(</span><span class="s">"Bicycle Used"</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">schema</span><span class="p">.</span><span class="n">execute</span><span class="p">(</span><span class="n">client</span><span class="p">)</span>

<span class="n">create_schema</span><span class="p">(</span><span class="n">client</span><span class="p">)</span>
</code></pre></div></div><p>To review this schema-building WOQL query:</p><ol><li>The when will perform the operation for every time its first argument is True. In this case, exactly once.<li>We perform all operations within the and.</ol><p>So here’s the operations we have performed:</p><ol><li>We created three different document types (given by the <code class="highlighter-rouge">doctype</code> function): <code class="highlighter-rouge">Station</code> , <code class="highlighter-rouge">Journey</code> and <code class="highlighter-rouge">Bicycle</code><li>We added <code class="highlighter-rouge">label</code> (names) or <code class="highlighter-rouge">description</code> (short descriptions) to them.<li>We created properties for <code class="highlighter-rouge">Journey</code>, we do that by using the <code class="highlighter-rouge">property</code> function after <code class="highlighter-rouge">Journey</code> with the first argument as the name of the property and the second argument as the type (or range) of the property.<li>For each property, you have to provide an id and the type of that property in <code class="highlighter-rouge">property</code>, as with class you can add a <code class="highlighter-rouge">label</code> to it as well.</ol><p>Go to the <a href="http://localhost:6363/console">console</a>, check that you have successfully created the schema by clicking the Schema button on the left. You should now be able to see the classes and properties in table format and get a graph representation by clicking the ‘graph’ button (circled in red):</p><p><img src="https://miro.medium.com/max/2756/1*1e2iw6CJnWm3NWTFuc9HKw.png" alt="showing classes in schema" /></p><p><img src="https://miro.medium.com/max/2780/1*x95n_XNGsO5-pNJci1iTJA.png" alt="graph of the classes in schema" /></p><p><img src="https://miro.medium.com/max/2754/1*ty448DHo8KcoUsFZGJ8n_Q.png" alt="showing properties in schema" /></p><p><img src="https://miro.medium.com/max/2736/1*xY5-Liid961dk1T-GfuE3g.png" alt="graph of the properties in schema" /></p><hr /><h2 id="load-in-the-data"> <a href="#load-in-the-data" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#link"></use></svg></a> Load in the Data</h2><p>Assume we have a list of csvs that we would like to load.</p><div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">csvs</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s">"https://terminusdb.com/t/data/bikeshare/2011-capitalbikeshare-tripdata.csv"</span><span class="p">,</span>
    <span class="s">"https://terminusdb.com/t/data/bikeshare/2012Q1-capitalbikeshare-tripdata.csv"</span><span class="p">,</span>
    <span class="s">"https://terminusdb.com/t/data/bikeshare/2010-capitalbikeshare-tripdata.csv"</span><span class="p">,</span>
    <span class="s">"https://terminusdb.com/t/data/bikeshare/2012Q2-capitalbikeshare-tripdata.csv"</span><span class="p">,</span>
    <span class="s">"https://terminusdb.com/t/data/bikeshare/2012Q3-capitalbikeshare-tripdata.csv"</span><span class="p">,</span>
    <span class="s">"https://terminusdb.com/t/data/bikeshare/2012Q4-capitalbikeshare-tripdata.csv"</span><span class="p">,</span>
    <span class="s">"https://terminusdb.com/t/data/bikeshare/2013Q1-capitalbikeshare-tripdata.csv"</span><span class="p">,</span>
    <span class="s">"https://terminusdb.com/t/data/bikeshare/2013Q2-capitalbikeshare-tripdata.csv"</span><span class="p">,</span>
    <span class="s">"https://terminusdb.com/t/data/bikeshare/2013Q3-capitalbikeshare-tripdata.csv"</span><span class="p">,</span>
    <span class="s">"https://terminusdb.com/t/data/bikeshare/2013Q4-capitalbikeshare-tripdata.csv"</span><span class="p">,</span>
    <span class="s">"https://terminusdb.com/t/data/bikeshare/2014Q1-capitalbikeshare-tripdata.csv"</span><span class="p">,</span>
    <span class="s">"https://terminusdb.com/t/data/bikeshare/2014Q2-capitalbikeshare-tripdata.csv"</span><span class="p">,</span>
    <span class="s">"https://terminusdb.com/t/data/bikeshare/2014Q3-capitalbikeshare-tripdata.csv"</span><span class="p">,</span>
    <span class="s">"https://terminusdb.com/t/data/bikeshare/2014Q4-capitalbikeshare-tripdata.csv"</span><span class="p">,</span>
    <span class="s">"https://terminusdb.com/t/data/bikeshare/2015Q1-capitalbikeshare-tripdata.csv"</span><span class="p">,</span>
    <span class="s">"https://terminusdb.com/t/data/bikeshare/2015Q2-capitalbikeshare-tripdata.csv"</span><span class="p">,</span>
    <span class="s">"https://terminusdb.com/t/data/bikeshare/2015Q3-capitalbikeshare-tripdata.csv"</span><span class="p">,</span>
    <span class="s">"https://terminusdb.com/t/data/bikeshare/2015Q4-capitalbikeshare-tripdata.csv"</span><span class="p">,</span>
    <span class="s">"https://terminusdb.com/t/data/bikeshare/2016Q1-capitalbikeshare-tripdata.csv"</span><span class="p">,</span>
    <span class="s">"https://terminusdb.com/t/data/bikeshare/2016Q2-capitalbikeshare-tripdata.csv"</span><span class="p">,</span>
    <span class="s">"https://terminusdb.com/t/data/bikeshare/2016Q3-capitalbikeshare-tripdata.csv"</span><span class="p">,</span>
    <span class="s">"https://terminusdb.com/t/data/bikeshare/2016Q4-capitalbikeshare-tripdata.csv"</span><span class="p">,</span>
    <span class="s">"https://terminusdb.com/t/data/bikeshare/2017Q1-capitalbikeshare-tripdata.csv"</span><span class="p">,</span>
    <span class="s">"https://terminusdb.com/t/data/bikeshare/2017Q2-capitalbikeshare-tripdata.csv"</span><span class="p">,</span>
    <span class="s">"https://terminusdb.com/t/data/bikeshare/2017Q3-capitalbikeshare-tripdata.csv"</span><span class="p">,</span>
    <span class="s">"https://terminusdb.com/t/data/bikeshare/2017Q4-capitalbikeshare-tripdata.csv"</span><span class="p">,</span>
    <span class="s">"https://terminusdb.com/t/data/bikeshare/201801_capitalbikeshare_tripdata.csv"</span><span class="p">,</span>
    <span class="s">"https://terminusdb.com/t/data/bikeshare/201802-capitalbikeshare-tripdata.csv"</span><span class="p">,</span>
    <span class="s">"https://terminusdb.com/t/data/bikeshare/201803-capitalbikeshare-tripdata.csv"</span><span class="p">,</span>
    <span class="s">"https://terminusdb.com/t/data/bikeshare/201804-capitalbikeshare-tripdata.csv"</span><span class="p">,</span>
    <span class="s">"https://terminusdb.com/t/data/bikeshare/201805-capitalbikeshare-tripdata.csv"</span><span class="p">,</span>
    <span class="s">"https://terminusdb.com/t/data/bikeshare/201806-capitalbikeshare-tripdata.csv"</span><span class="p">,</span>
    <span class="s">"https://terminusdb.com/t/data/bikeshare/201807-capitalbikeshare-tripdata.csv"</span><span class="p">,</span>
    <span class="s">"https://terminusdb.com/t/data/bikeshare/201808-capitalbikeshare-tripdata.csv"</span><span class="p">,</span>
    <span class="s">"https://terminusdb.com/t/data/bikeshare/201809-capitalbikeshare-tripdata.csv"</span><span class="p">,</span>
    <span class="s">"https://terminusdb.com/t/data/bikeshare/201810-capitalbikeshare-tripdata.csv"</span><span class="p">,</span>
    <span class="s">"https://terminusdb.com/t/data/bikeshare/201811-capitalbikeshare-tripdata.csv"</span><span class="p">,</span>
    <span class="s">"https://terminusdb.com/t/data/bikeshare/201812-capitalbikeshare-tripdata.csv"</span>
<span class="p">]</span>
</code></pre></div></div><p>These are hosted on a server, for</p><p>The process of loading csvs consist of 3 parts:</p><ul><li>reading the csvs in a temporary space and assign variables to them<li>perform data wrangles which prepare the data in the temporary space fit for our schema<li>insert the inputs into the graph database according to the schema.</ul><h3 id="get-csvs-into-variables"> <a href="#get-csvs-into-variables" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#link"></use></svg></a> Get csvs into variables</h3><div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">get_csv_variables</span><span class="p">(</span><span class="n">url</span><span class="p">):</span>
    <span class="s">"""Extracting the data from a CSV and binding it to variables
       Parameters
       ==========
       client : a WOQLClient() connection
       url : string, the URL of the CSV
       """</span>
    <span class="n">csv</span> <span class="o">=</span> <span class="n">WOQLQuery</span><span class="p">().</span><span class="n">get</span><span class="p">(</span>
        <span class="n">WOQLQuery</span><span class="p">().</span><span class="n">woql_as</span><span class="p">(</span><span class="s">"Start station"</span><span class="p">,</span> <span class="s">"v:Start_Station"</span><span class="p">).</span>
        <span class="n">woql_as</span><span class="p">(</span><span class="s">"End station"</span><span class="p">,</span> <span class="s">"v:End_Station"</span><span class="p">).</span>
        <span class="n">woql_as</span><span class="p">(</span><span class="s">"Start date"</span><span class="p">,</span> <span class="s">"v:Start_Time"</span><span class="p">).</span>
        <span class="n">woql_as</span><span class="p">(</span><span class="s">"End date"</span><span class="p">,</span> <span class="s">"v:End_Time"</span><span class="p">).</span>
        <span class="n">woql_as</span><span class="p">(</span><span class="s">"Duration"</span><span class="p">,</span> <span class="s">"v:Duration"</span><span class="p">).</span>
        <span class="n">woql_as</span><span class="p">(</span><span class="s">"Start station number"</span><span class="p">,</span> <span class="s">"v:Start_ID"</span><span class="p">).</span>
        <span class="n">woql_as</span><span class="p">(</span><span class="s">"End station number"</span><span class="p">,</span> <span class="s">"v:End_ID"</span><span class="p">).</span>
        <span class="n">woql_as</span><span class="p">(</span><span class="s">"Bike number"</span><span class="p">,</span> <span class="s">"v:Bike"</span><span class="p">).</span>
        <span class="n">woql_as</span><span class="p">(</span><span class="s">"Member type"</span><span class="p">,</span> <span class="s">"v:Member_Type"</span><span class="p">)</span>
    <span class="p">).</span><span class="n">remote</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">csv</span>
</code></pre></div></div><p>This function consist the part of the query that imports the data from CSV in a <code class="highlighter-rouge">const</code> variable named <code class="highlighter-rouge">csv</code>. Then we create a list of WOQL operators and save it in another constvariable called <code class="highlighter-rouge">wrangles</code>, we combine the two parts of the query with a <code class="highlighter-rouge">woql_and</code> operator.</p><h3 id="data-wrangles"> <a href="#data-wrangles" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#link"></use></svg></a> Data wrangles</h3><div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">get_wrangles</span><span class="p">():</span>
    <span class="n">wrangles</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">WOQLQuery</span><span class="p">().</span><span class="n">idgen</span><span class="p">(</span><span class="s">"doc:Journey"</span><span class="p">,</span> <span class="p">[</span>
            <span class="s">"v:Start_ID"</span><span class="p">,</span> <span class="s">"v:Start_Time"</span><span class="p">,</span> <span class="s">"v:Bike"</span><span class="p">],</span> <span class="s">"v:Journey_ID"</span><span class="p">),</span>
        <span class="n">WOQLQuery</span><span class="p">().</span><span class="n">idgen</span><span class="p">(</span><span class="s">"doc:Station"</span><span class="p">,</span> <span class="p">[</span>
            <span class="s">"v:Start_ID"</span><span class="p">],</span> <span class="s">"v:Start_Station_URL"</span><span class="p">),</span>
        <span class="n">WOQLQuery</span><span class="p">().</span><span class="n">cast</span><span class="p">(</span><span class="s">"v:Duration"</span><span class="p">,</span> <span class="s">"xsd:integer"</span><span class="p">,</span> <span class="s">"v:Duration_Cast"</span><span class="p">),</span>
        <span class="n">WOQLQuery</span><span class="p">().</span><span class="n">cast</span><span class="p">(</span><span class="s">"v:Bike"</span><span class="p">,</span> <span class="s">"xsd:string"</span><span class="p">,</span> <span class="s">"v:Bike_Label"</span><span class="p">),</span>
        <span class="n">WOQLQuery</span><span class="p">().</span><span class="n">cast</span><span class="p">(</span><span class="s">"v:Start_Time"</span><span class="p">,</span> <span class="s">"xsd:dateTime"</span><span class="p">,</span> <span class="s">"v:Start_Time_Cast"</span><span class="p">),</span>
        <span class="n">WOQLQuery</span><span class="p">().</span><span class="n">cast</span><span class="p">(</span><span class="s">"v:End_Time"</span><span class="p">,</span> <span class="s">"xsd:dateTime"</span><span class="p">,</span> <span class="s">"v:End_Time_Cast"</span><span class="p">),</span>
        <span class="n">WOQLQuery</span><span class="p">().</span><span class="n">cast</span><span class="p">(</span><span class="s">"v:Start_Station"</span><span class="p">,</span> <span class="s">"xsd:string"</span><span class="p">,</span> <span class="s">"v:Start_Station_Label"</span><span class="p">),</span>
        <span class="n">WOQLQuery</span><span class="p">().</span><span class="n">cast</span><span class="p">(</span><span class="s">"v:End_Station"</span><span class="p">,</span> <span class="s">"xsd:string"</span><span class="p">,</span> <span class="s">"v:End_Station_Label"</span><span class="p">),</span>
        <span class="n">WOQLQuery</span><span class="p">().</span><span class="n">idgen</span><span class="p">(</span><span class="s">"doc:Station"</span><span class="p">,</span> <span class="p">[</span><span class="s">"v:End_ID"</span><span class="p">],</span> <span class="s">"v:End_Station_URL"</span><span class="p">),</span>
        <span class="n">WOQLQuery</span><span class="p">().</span><span class="n">idgen</span><span class="p">(</span><span class="s">"doc:Bicycle"</span><span class="p">,</span> <span class="p">[</span><span class="s">"v:Bike_Label"</span><span class="p">],</span> <span class="s">"v:Bike_URL"</span><span class="p">),</span>
        <span class="n">WOQLQuery</span><span class="p">().</span><span class="n">concat</span><span class="p">(</span><span class="s">"Journey from v:Start_ID to v:End_ID at v:Start_Time"</span><span class="p">,</span> <span class="s">"v:Journey_Label"</span><span class="p">),</span>
        <span class="n">WOQLQuery</span><span class="p">().</span><span class="n">concat</span><span class="p">(</span><span class="s">"Bike v:Bike from v:Start_Station to v:End_Station at v:Start_Time until v:End_Time"</span><span class="p">,</span>
                           <span class="s">"v:Journey_Description"</span><span class="p">)</span>
    <span class="p">]</span>
    <span class="k">return</span> <span class="n">wrangles</span>
</code></pre></div></div><p>The <code class="highlighter-rouge">wrangles</code> is a list of WOQLQuery objects. They use 3 WOQL functions to transform the data into the correct form for input. In each case, the function creates a new variable as output — the last argument in each case. The <code class="highlighter-rouge">idgen</code> function generates IDs for our three document types <code class="highlighter-rouge">Journey</code>, <code class="highlighter-rouge">Station</code>, and <code class="highlighter-rouge">Bicycle</code>. The first argument is the prefix that will be used, the second is a list of variables which combine to give a unique identity for the id. For example, in <code class="highlighter-rouge">Journey</code> we use 3 fields in the <code class="highlighter-rouge">csv</code> (<code class="highlighter-rouge">Start_ID</code>, <code class="highlighter-rouge">Start_Time</code> and <code class="highlighter-rouge">Bike</code>) to generate a unique id <code class="highlighter-rouge">Journey_ID</code>.</p><p>Besides generating IDs, we also create new fields with new data types, for example, we use <code class="highlighter-rouge">typecast</code> to cast <code class="highlighter-rouge">Duration</code> into <code class="highlighter-rouge">integer</code> and store it as <code class="highlighter-rouge">Duration_Cast</code>. We can also use <code class="highlighter-rouge">concat</code> to contract new text formatted with variables in the fields — for example, to create <code class="highlighter-rouge">Journey_Label</code>.</p><h3 id="insert-query"> <a href="#insert-query" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#link"></use></svg></a> Insert Query</h3><div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">get_inserts</span><span class="p">():</span>
    <span class="n">inserts</span> <span class="o">=</span> <span class="n">WOQLQuery</span><span class="p">().</span><span class="n">woql_and</span><span class="p">(</span>
        <span class="n">WOQLQuery</span><span class="p">().</span><span class="n">insert</span><span class="p">(</span><span class="s">"v:Journey_ID"</span><span class="p">,</span> <span class="s">"Journey"</span><span class="p">).</span>
            <span class="n">label</span><span class="p">(</span><span class="s">"v:Journey_Label"</span><span class="p">).</span>
            <span class="n">description</span><span class="p">(</span><span class="s">"v:Journey_Description"</span><span class="p">).</span>
            <span class="nb">property</span><span class="p">(</span><span class="s">"start_time"</span><span class="p">,</span> <span class="s">"v:Start_Time_Cast"</span><span class="p">).</span>
            <span class="nb">property</span><span class="p">(</span><span class="s">"end_time"</span><span class="p">,</span> <span class="s">"v:End_Time_Cast"</span><span class="p">).</span>
            <span class="nb">property</span><span class="p">(</span><span class="s">"duration"</span><span class="p">,</span> <span class="s">"v:Duration_Cast"</span><span class="p">).</span>
            <span class="nb">property</span><span class="p">(</span><span class="s">"start_station"</span><span class="p">,</span> <span class="s">"v:Start_Station_URL"</span><span class="p">).</span>
            <span class="nb">property</span><span class="p">(</span><span class="s">"end_station"</span><span class="p">,</span> <span class="s">"v:End_Station_URL"</span><span class="p">).</span>
            <span class="nb">property</span><span class="p">(</span><span class="s">"journey_bicycle"</span><span class="p">,</span> <span class="s">"v:Bike_URL"</span><span class="p">),</span>
        <span class="n">WOQLQuery</span><span class="p">().</span><span class="n">insert</span><span class="p">(</span><span class="s">"v:Start_Station_URL"</span><span class="p">,</span> <span class="s">"Station"</span><span class="p">).</span>
            <span class="n">label</span><span class="p">(</span><span class="s">"v:Start_Station_Label"</span><span class="p">),</span>
        <span class="n">WOQLQuery</span><span class="p">().</span><span class="n">insert</span><span class="p">(</span><span class="s">"v:End_Station_URL"</span><span class="p">,</span> <span class="s">"Station"</span><span class="p">).</span>
            <span class="n">label</span><span class="p">(</span><span class="s">"v:End_Station_Label"</span><span class="p">),</span>
        <span class="n">WOQLQuery</span><span class="p">().</span><span class="n">insert</span><span class="p">(</span><span class="s">"v:Bike_URL"</span><span class="p">,</span> <span class="s">"Bicycle"</span><span class="p">).</span>
            <span class="n">label</span><span class="p">(</span><span class="s">"v:Bike_Label"</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">inserts</span>
</code></pre></div></div><p>This is the part of the query that actually inserts the data into the structure that we defined on our schema.</p><ul><li>The <code class="highlighter-rouge">insert</code> function inserts a new node into the database with the id <code class="highlighter-rouge">Journey_ID</code> and type <code class="highlighter-rouge">Journey</code> we add properties like <code class="highlighter-rouge">start_time</code>, <code class="highlighter-rouge">end_time</code>, <code class="highlighter-rouge">duration</code>, <code class="highlighter-rouge">start_station</code>, <code class="highlighter-rouge">end_station</code> and <code class="highlighter-rouge">label</code> and put the variables produced above in their correct spots.<li>For <code class="highlighter-rouge">Start_Station_URL</code>, <code class="highlighter-rouge">End_Station_URL</code> and <code class="highlighter-rouge">Bike_URL</code>, we assign a <code class="highlighter-rouge">type</code> and <code class="highlighter-rouge">label</code> for each of them.</ul><h3 id="combine-the-3-and-load-the-csvs"> <a href="#combine-the-3-and-load-the-csvs" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#link"></use></svg></a> Combine the 3 and load the csvs</h3><div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">load_csvs</span><span class="p">(</span><span class="n">client</span><span class="p">,</span> <span class="n">csvlist</span><span class="p">,</span> <span class="n">wrangl</span><span class="p">,</span> <span class="n">insert</span><span class="p">):</span>
    <span class="s">"""Load the CSVs as input
       Parameters
       ==========
       client : a WOQLClient() connection
       csvs : a dict of all csvs to be input
    """</span>
    <span class="k">for</span> <span class="n">url</span> <span class="ow">in</span> <span class="n">csvlist</span><span class="p">:</span>
        <span class="n">csv</span> <span class="o">=</span> <span class="n">get_csv_variables</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
        <span class="n">inputs</span> <span class="o">=</span> <span class="n">WOQLQuery</span><span class="p">().</span><span class="n">woql_and</span><span class="p">(</span><span class="n">csv</span><span class="p">,</span> <span class="o">*</span><span class="n">wrangl</span><span class="p">)</span>
        <span class="n">answer</span> <span class="o">=</span> <span class="n">WOQLQuery</span><span class="p">().</span><span class="n">when</span><span class="p">(</span><span class="n">inputs</span><span class="p">,</span> <span class="n">insert</span><span class="p">)</span>
        <span class="n">answer</span><span class="p">.</span><span class="n">execute</span><span class="p">(</span><span class="n">client</span><span class="p">)</span>

<span class="n">load_csvs</span><span class="p">(</span><span class="n">client</span><span class="p">,</span> <span class="n">csvs</span><span class="p">,</span> <span class="n">get_wrangles</span><span class="p">(),</span> <span class="n">get_inserts</span><span class="p">())</span>
</code></pre></div></div><p>Here, for each url in the list above (a list named csvs) we combine the result of <code class="highlighter-rouge">get_csv_variables</code> and result of <code class="highlighter-rouge">get_wrangles</code> with a <code class="highlighter-rouge">woql_and</code> and called it <code class="highlighter-rouge">inputs</code>. When the <code class="highlighter-rouge">inputs</code> are ready, perform get_inserts.</p><hr /><h2 id="query-the-data"> <a href="#query-the-data" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#link"></use></svg></a> Query The Data</h2><div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">query_data</span><span class="p">(</span><span class="n">client</span><span class="p">):</span>
    <span class="s">"""The query which query the database
        Parameters - it uses variables rather than the fluent style as an example
        ==========
        client : a WOQLClient() connection
    """</span>
    <span class="n">conditions</span> <span class="o">=</span> <span class="p">[</span><span class="n">WOQLQuery</span><span class="p">().</span><span class="n">triple</span><span class="p">(</span><span class="s">"v:Journey"</span><span class="p">,</span> <span class="s">"type"</span><span class="p">,</span> <span class="s">"scm:Journey"</span><span class="p">),</span>
                  <span class="n">WOQLQuery</span><span class="p">().</span><span class="n">triple</span><span class="p">(</span><span class="s">"v:Journey"</span><span class="p">,</span> <span class="s">"start_station"</span><span class="p">,</span> <span class="s">"v:Start"</span><span class="p">),</span>
                  <span class="n">WOQLQuery</span><span class="p">().</span><span class="n">opt</span><span class="p">().</span><span class="n">triple</span><span class="p">(</span><span class="s">"v:Start"</span><span class="p">,</span> <span class="s">"label"</span><span class="p">,</span> <span class="s">"v:Start_Label"</span><span class="p">),</span>
                  <span class="n">WOQLQuery</span><span class="p">().</span><span class="n">triple</span><span class="p">(</span><span class="s">"v:Journey"</span><span class="p">,</span> <span class="s">"end_station"</span><span class="p">,</span> <span class="s">"v:End"</span><span class="p">),</span>
                  <span class="n">WOQLQuery</span><span class="p">().</span><span class="n">opt</span><span class="p">().</span><span class="n">triple</span><span class="p">(</span><span class="s">"v:End"</span><span class="p">,</span> <span class="s">"label"</span><span class="p">,</span> <span class="s">"v:End_Label"</span><span class="p">),</span>
                  <span class="n">WOQLQuery</span><span class="p">().</span><span class="n">triple</span><span class="p">(</span><span class="s">"v:Journey"</span><span class="p">,</span> <span class="s">"journey_bicycle"</span><span class="p">,</span> <span class="s">"v:Bike"</span><span class="p">)]</span>
    <span class="n">query</span> <span class="o">=</span> <span class="n">WOQLQuery</span><span class="p">().</span><span class="n">select</span><span class="p">(</span><span class="s">"v:Start"</span><span class="p">,</span>
                               <span class="s">"v:Start_Label"</span><span class="p">,</span>
                               <span class="s">"v:End"</span><span class="p">,</span>
                               <span class="s">"v:End_Label"</span><span class="p">).</span><span class="n">woql_and</span><span class="p">(</span><span class="o">*</span><span class="n">conditions</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">query</span><span class="p">.</span><span class="n">execute</span><span class="p">(</span><span class="n">client</span><span class="p">)</span>

<span class="n">result</span> <span class="o">=</span> <span class="n">query_data</span><span class="p">(</span><span class="n">client</span><span class="p">)</span>
</code></pre></div></div><p>Here we used <code class="highlighter-rouge">select</code> to filter out the variables (those starting with <code class="highlighter-rouge">v:</code>) that appear in our output. Then we used <code class="highlighter-rouge">and</code> to link all the conditions we want to include, as you can see there are lot’s of <code class="highlighter-rouge">triples</code> to be conditioned. The ones with <code class="highlighter-rouge">opt()</code> means that they are optional — it will be ignored if that data is missing (instead of returning an error — very handy).</p><p>The query can be translated as below:</p><ol><li>select all the <code class="highlighter-rouge">Journeys</code><li>and all the <code class="highlighter-rouge">start_stations</code> of all the <code class="highlighter-rouge">Journeys</code> (let’s call them <code class="highlighter-rouge">Start</code>)<li>and, if any, all the <code class="highlighter-rouge">labels</code> of the <code class="highlighter-rouge">start_stations</code> (let’s call them <code class="highlighter-rouge">Start_Label</code>)<li>and all the <code class="highlighter-rouge">end_stations</code> of all the <code class="highlighter-rouge">Journeys</code> (let’s call them <code class="highlighter-rouge">End</code>)<li>and, if any, all the <code class="highlighter-rouge">labels</code> of the <code class="highlighter-rouge">end_stations</code> (let’s call them <code class="highlighter-rouge">End_Label</code>)<li>and all the <code class="highlighter-rouge">journey_bicycles</code> of all the <code class="highlighter-rouge">Journeys</code> (let’s call them <code class="highlighter-rouge">Bike</code>)</ol><p>Note that we store the result as a variable which can be used with <code class="highlighter-rouge">query_to_df</code> to turn it into a pandas DataFrame</p><div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">query_to_df</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</code></pre></div></div><p><img src="../..//assets/images/console/result_as_df.png" alt="Result as a DataFrame" /></p><hr /><h2 id="graph-visualisation"> <a href="#graph-visualisation" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#link"></use></svg></a> Graph Visualisation</h2><p>Graph Visualisation can be created in the TerminusDB console, please see the <a href="/docs/getting-started/start-tutorials/console_js/#graph-visualisation">Graph Visualisation session at Create TerminusDB Graph with Console</a>.</p><hr><footer role="contentinfo"><p class="text-small text-grey-dk-000 mb-0">Copyright &copy; 2020 - TerminusDB | Distributed by an <a href="https://github.com/terminusdb/terminusdb-server/blob/master/LICENSE">GPL-3.0 license.</a></p></footer></div></div></div></div>
